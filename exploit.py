import requests
import time

# ANSI color codes
RED    = "\033[91m"
GREEN  = "\033[92m"
YELLOW = "\033[93m"
CYAN   = "\033[96m"
RESET  = "\033[0m"
BOLD   = "\033[1m"

ascii_art = f"""{GREEN}{BOLD}
   ______           _       _ _   
  |  ____|         | |     | | |  
  | |__   _ __ ___ | | ___ | | |_ 
  |  __| | '_ ` _ \| |/ _ \| | __|
  | |____| | | | | | | (_) | | |_ 
  |______|_| |_| |_|_|\___/|_|\__|
     E X P L O I T   L A B
{RESET}
"""

print(ascii_art)

url = "http://localhost:5001/"
payload = "thequickbrownfoxjumpsoverthelazydog"
flag = "CTF{YoUMadeIt}"

print(f"{BOLD}{CYAN}[+] Sending exploit payload:{RESET} {YELLOW}{payload}{RESET}")
try:
    r = requests.post(url, data={"username": payload}, timeout=2)
    if r.status_code == 500:
        print(f"\n{GREEN}[+] Crash detected! Exploit successful, simulating shell access...{RESET}")
        time.sleep(1)
        print(f"\n{CYAN}[appuser@lab ~]$ whoami{RESET}")
        time.sleep(0.5)
        print(f"{YELLOW}appuser{RESET}")
        time.sleep(0.5)
        print(f"{CYAN}[appuser@lab ~]$ cat flag.txt{RESET}")
        time.sleep(0.5)
        print(f"{GREEN}{flag}{RESET}")
        print(f"\n{BOLD}{GREEN}[+] Flag captured above.{RESET}")
    else:
        print(f"\n{RED}[-] Exploit failed. No crash detected.{RESET}")
except Exception as e:
    if "Connection aborted" in str(e) or "Remote end closed connection" in str(e):
        print(f"\n{GREEN}[+] Crash detected! Exploit likely successful.{RESET}")
        print(f"{CYAN}[appuser@lab ~]$ cat flag.txt{RESET}")
        print(f"{GREEN}{flag}{RESET}")
        print(f"\n{BOLD}{GREEN}[+] Flag captured above. Remember to restart the server for more tests.{RESET}")
    else:
        print(f"\n{RED}[!] Error during exploit: {e}{RESET}")
